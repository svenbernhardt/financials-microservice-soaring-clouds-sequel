box: maven:latest
build:
  steps:
    # Build Spring Boot Sample application
    - script:
        name: Maven install
        code: mvn -f financials-ms/pom.xml install -DskipTests

box: node
test-api:
    steps:
      - npm-install:
        options: --no-optional
      - script:
        name: print-dredd-version
        code: npm info dredd version
      #- script:
      #  name: configure-mongo
      #  code: export MONGO_URI="mongodb://$MONGO_PORT_27017_TCP_ADDR:$MONGO_PORT_27017_TCP_PORT"
      - npm-test

box:
  id: openjdk
  tag: 8-jre-alpine
  cmd: /bin/sh # see: http://devcenter.wercker.com/docs/faq/alpine-faq
push-to-releases:
  steps:
    # Push to public docker repo Container Registry (CR)
    - script:
      code: |
        mv $WERCKER SOURCE/financials-ms/target/financials-microservice-1.0.0.0.jar /financials-ms.jar
        touch /financials-ms.jar
    - internal/docker-push:
        username: $DOCKER_USERNAME
        password: $DOCKER_PASSWORD
        tag: latest
        cmd: java -Djava.security.egd=file:/dev/./urandom -jar financials-ms.jar
        repository: sbernhardtoc/financials-ms-1.0.0.0
        registry: https://registry.hub.docker.com
